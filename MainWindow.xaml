<Window x:Class="Booky.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Booky"
        Title="Booky · VoidMind"
        Icon="Assets/book.ico"
        Width="500"
        SizeToContent="Height"
        MinWidth="450"
        MinHeight="400"
        MaxHeight="800"
        Background="{StaticResource BackgroundBrush}"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResizeWithGrip"
        AllowDrop="True"
        Drop="Window_Drop"
        DragOver="Window_DragOver">

    <Window.Resources>
        <!-- Converters -->
        <local:NullToCollapsedConverter x:Key="NullToCollapsedConverter" />

        <!-- Book icon path data -->
        <Geometry x:Key="BookIcon">M19 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H19C20.1 22 21 21.1 21 20V4C21 2.9 20.1 2 19 2ZM6 4H11V12L8.5 10.5L6 12V4Z</Geometry>
        <Geometry x:Key="SettingsIcon">M19.14 12.94C19.18 12.64 19.2 12.33 19.2 12C19.2 11.68 19.18 11.36 19.13 11.06L21.16 9.48C21.34 9.34 21.39 9.07 21.28 8.87L19.36 5.55C19.24 5.33 18.99 5.26 18.77 5.33L16.38 6.29C15.88 5.91 15.35 5.59 14.76 5.35L14.4 2.81C14.36 2.57 14.16 2.4 13.92 2.4H10.08C9.84 2.4 9.65 2.57 9.61 2.81L9.25 5.35C8.66 5.59 8.12 5.92 7.63 6.29L5.24 5.33C5.02 5.25 4.77 5.33 4.65 5.55L2.74 8.87C2.62 9.08 2.66 9.34 2.86 9.48L4.89 11.06C4.84 11.36 4.8 11.69 4.8 12C4.8 12.31 4.82 12.64 4.87 12.94L2.85 14.52C2.67 14.66 2.62 14.93 2.73 15.13L4.65 18.45C4.77 18.67 5.02 18.74 5.24 18.67L7.63 17.71C8.13 18.09 8.66 18.41 9.25 18.65L9.61 21.19C9.65 21.43 9.84 21.6 10.08 21.6H13.92C14.16 21.6 14.36 21.43 14.39 21.19L14.75 18.65C15.34 18.41 15.88 18.09 16.37 17.71L18.76 18.67C18.98 18.75 19.23 18.67 19.35 18.45L21.27 15.13C21.39 14.91 21.34 14.66 21.15 14.52L19.14 12.94ZM12 15.6C10.02 15.6 8.4 13.98 8.4 12C8.4 10.02 10.02 8.4 12 8.4C13.98 8.4 15.6 10.02 15.6 12C15.6 13.98 13.98 15.6 12 15.6Z</Geometry>
        <Geometry x:Key="CheckIcon">M9 16.17L4.83 12L3.41 13.41L9 19L21 7L19.59 5.59L9 16.17Z</Geometry>
        <Geometry x:Key="CloseIcon">M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z</Geometry>
        <Geometry x:Key="KindleIcon">M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z</Geometry>
        <Geometry x:Key="SendIcon">M2.01 21L23 12 2.01 3 2 10l15 2-15 2z</Geometry>
    </Window.Resources>

    <Grid Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <Image x:Name="LogoImage"
                       Source="Assets/book.png"
                       Width="40" Height="40"
                       Margin="0,0,12,0"
                       MouseLeftButtonUp="Logo_Click" />
                <TextBlock Text="Booky"
                           FontSize="28"
                           FontWeight="Bold"
                           Foreground="{StaticResource PrimaryBrush}"
                           VerticalAlignment="Center" />
            </StackPanel>

            <!-- Kindle Settings Button -->
            <Button x:Name="KindleSettingsButton"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Style="{StaticResource SecondaryButton}"
                    Padding="8"
                    Click="KindleSettings_Click"
                    ToolTip="Kindle Settings">
                <StackPanel Orientation="Horizontal">
                    <Path Data="{StaticResource KindleIcon}"
                          Fill="{StaticResource PrimaryBrush}"
                          Width="20" Height="20"
                          Stretch="Uniform" />
                    <TextBlock x:Name="KindleStatusText"
                               Text="Setup Kindle"
                               Margin="8,0,0,0"
                               VerticalAlignment="Center"
                               Foreground="{StaticResource PrimaryBrush}"
                               FontSize="12" />
                </StackPanel>
            </Button>
        </Grid>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <!-- Drop Zone (shown when no files) -->
            <Border x:Name="DropZone"
                    Background="{StaticResource DropZoneBrush}"
                    BorderBrush="{StaticResource AccentBrush}"
                    BorderThickness="2"
                    CornerRadius="16"
                    Cursor="Hand"
                    MinHeight="250"
                    MouseLeftButtonUp="DropZone_Click"
                    Style="{x:Null}">

                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock Text="Drop your book here"
                               FontSize="20"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource TextBrush}"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,8" />
                    <TextBlock Text="MOBI &amp; EPUB files"
                               FontSize="14"
                               Foreground="{StaticResource TextMutedBrush}"
                               HorizontalAlignment="Center"
                               Margin="0,0,0,16" />
                    <TextBlock Text="or click to browse"
                               FontSize="13"
                               Foreground="{StaticResource AccentBrush}"
                               HorizontalAlignment="Center"
                               TextDecorations="Underline" />
                </StackPanel>
            </Border>

            <!-- File Loaded Panel (shown when file is loaded) -->
            <Border x:Name="FilePanel"
                    Visibility="Collapsed"
                    Background="{StaticResource CardBrush}"
                    CornerRadius="16"
                    Padding="24">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" Opacity="0.08" ShadowDepth="4" Direction="270" />
                </Border.Effect>

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Close button -->
                    <Button Grid.Row="0"
                            HorizontalAlignment="Right"
                            Style="{StaticResource SecondaryButton}"
                            Padding="6"
                            BorderThickness="0"
                            Click="ClearFile_Click"
                            ToolTip="Clear file">
                        <Path Data="{StaticResource CloseIcon}"
                              Fill="{StaticResource TextMutedBrush}"
                              Width="16" Height="16"
                              Stretch="Uniform" />
                    </Button>

                    <!-- File info with cover -->
                    <Grid Grid.Row="1" Margin="0,0,0,24">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <!-- Cover image -->
                        <Border x:Name="CoverBorder"
                                Grid.Column="0"
                                Width="80"
                                Height="120"
                                Margin="0,0,16,0"
                                CornerRadius="4"
                                Background="{StaticResource DropZoneBrush}"
                                Visibility="Collapsed">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="8" Opacity="0.15" ShadowDepth="2" Direction="270" />
                            </Border.Effect>
                            <Image x:Name="CoverImage"
                                   Stretch="UniformToFill"
                                   RenderOptions.BitmapScalingMode="HighQuality">
                                <Image.Clip>
                                    <RectangleGeometry Rect="0,0,80,120" RadiusX="4" RadiusY="4" />
                                </Image.Clip>
                            </Image>
                        </Border>

                        <!-- File info text -->
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <TextBlock x:Name="FileNameText"
                                       Text="book.mobi"
                                       FontSize="16"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextBrush}"
                                       TextTrimming="CharacterEllipsis" />
                            <TextBlock x:Name="FileTypeText"
                                       Text="MOBI File"
                                       FontSize="13"
                                       Foreground="{StaticResource TextMutedBrush}"
                                       Margin="0,4,0,0" />
                        </StackPanel>
                    </Grid>

                    <!-- Editable metadata -->
                    <StackPanel Grid.Row="2">
                        <TextBlock Text="Title"
                                   FontSize="13"
                                   FontWeight="Medium"
                                   Foreground="{StaticResource TextMutedBrush}"
                                   Margin="0,0,0,6" />
                        <TextBox x:Name="TitleTextBox"
                                 Style="{StaticResource ModernTextBox}"
                                 Margin="0,0,0,16" />

                        <TextBlock Text="Author"
                                   FontSize="13"
                                   FontWeight="Medium"
                                   Foreground="{StaticResource TextMutedBrush}"
                                   Margin="0,0,0,6" />
                        <TextBox x:Name="AuthorTextBox"
                                 Style="{StaticResource ModernTextBox}" />
                    </StackPanel>

                    <!-- Convert Button -->
                    <Button Grid.Row="3"
                            x:Name="ConvertButton"
                            Content="Convert to EPUB"
                            Style="{StaticResource PrimaryButton}"
                            HorizontalAlignment="Stretch"
                            Click="Convert_Click"
                            Margin="0,24,0,0" />

                    <!-- Success Buttons (hidden by default) -->
                    <StackPanel Grid.Row="3"
                                x:Name="SuccessPanel"
                                Visibility="Collapsed"
                                Margin="0,24,0,0">
                        <!-- Send to Kindle button (shown when Kindle is configured) -->
                        <Button x:Name="SendToKindleButton"
                                Style="{StaticResource PrimaryButton}"
                                HorizontalAlignment="Stretch"
                                Click="SendToKindle_Click"
                                Margin="0,0,0,12"
                                Visibility="Collapsed">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="{StaticResource SendIcon}"
                                      Fill="White"
                                      Width="16" Height="16"
                                      Stretch="Uniform"
                                      Margin="0,0,8,0" />
                                <TextBlock x:Name="SendToKindleButtonText" Text="Send to Kindle" />
                            </StackPanel>
                        </Button>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="12" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Button Grid.Column="0"
                                    Content="Open Folder"
                                    Style="{StaticResource SecondaryButton}"
                                    HorizontalAlignment="Stretch"
                                    Click="OpenFolder_Click" />
                            <Button Grid.Column="2"
                                    Content="Convert Another"
                                    Style="{StaticResource SecondaryButton}"
                                    HorizontalAlignment="Stretch"
                                    Click="ConvertAnother_Click" />
                        </Grid>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Multi-File Panel (shown when multiple files loaded) -->
            <Border x:Name="MultiFilePanel"
                    Visibility="Collapsed"
                    Background="{StaticResource CardBrush}"
                    CornerRadius="16"
                    Padding="24">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20" Opacity="0.08" ShadowDepth="4" Direction="270" />
                </Border.Effect>

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Close button -->
                    <Button Grid.Row="0"
                            HorizontalAlignment="Right"
                            Style="{StaticResource SecondaryButton}"
                            Padding="6"
                            BorderThickness="0"
                            Click="ClearFile_Click"
                            ToolTip="Clear all">
                        <Path Data="{StaticResource CloseIcon}"
                              Fill="{StaticResource TextMutedBrush}"
                              Width="16" Height="16"
                              Stretch="Uniform" />
                    </Button>

                    <!-- Header -->
                    <TextBlock Grid.Row="1"
                               x:Name="MultiFileHeader"
                               Text="3 books to convert"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="{StaticResource TextBrush}"
                               Margin="0,0,0,16" />

                    <!-- File List -->
                    <ListView Grid.Row="2"
                              x:Name="FileListView"
                              Background="Transparent"
                              BorderThickness="0"
                              ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                        <ListView.ItemContainerStyle>
                            <Style TargetType="ListViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                <Setter Property="Padding" Value="0,8" />
                                <Setter Property="Background" Value="Transparent" />
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="ListViewItem">
                                            <Border Background="{TemplateBinding Background}"
                                                    Padding="{TemplateBinding Padding}">
                                                <ContentPresenter />
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </ListView.ItemContainerStyle>
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="70" />
                                    </Grid.ColumnDefinitions>

                                    <!-- Small cover thumbnail -->
                                    <Border Grid.Column="0"
                                            Width="32" Height="48"
                                            Margin="0,0,12,0"
                                            CornerRadius="2"
                                            Background="{StaticResource DropZoneBrush}"
                                            Visibility="{Binding CoverImage, Converter={StaticResource NullToCollapsedConverter}}">
                                        <Image Source="{Binding CoverImage}"
                                               Stretch="UniformToFill"
                                               RenderOptions.BitmapScalingMode="HighQuality">
                                            <Image.Clip>
                                                <RectangleGeometry Rect="0,0,32,48" RadiusX="2" RadiusY="2" />
                                            </Image.Clip>
                                        </Image>
                                    </Border>

                                    <TextBox Grid.Column="1"
                                             Text="{Binding Title, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource ModernTextBox}"
                                             Margin="0,0,8,0"
                                             ToolTip="Title" />
                                    <TextBox Grid.Column="2"
                                             Text="{Binding Author, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource ModernTextBox}"
                                             Margin="0,0,8,0"
                                             ToolTip="Author" />
                                    <TextBlock Grid.Column="3"
                                               Text="{Binding Status}"
                                               Foreground="{StaticResource TextMutedBrush}"
                                               VerticalAlignment="Center"
                                               FontSize="12" />
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <!-- Convert All Button -->
                    <Button Grid.Row="3"
                            x:Name="ConvertAllButton"
                            Content="Convert All to EPUB"
                            Style="{StaticResource PrimaryButton}"
                            HorizontalAlignment="Stretch"
                            Click="ConvertAll_Click"
                            Margin="0,16,0,0" />

                    <!-- Success Buttons for batch -->
                    <StackPanel Grid.Row="3"
                                x:Name="BatchSuccessPanel"
                                Visibility="Collapsed"
                                Margin="0,16,0,0">
                        <!-- Send All to Kindle button -->
                        <Button x:Name="SendAllToKindleButton"
                                Style="{StaticResource PrimaryButton}"
                                HorizontalAlignment="Stretch"
                                Click="SendAllToKindle_Click"
                                Margin="0,0,0,12"
                                Visibility="Collapsed">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="{StaticResource SendIcon}"
                                      Fill="White"
                                      Width="16" Height="16"
                                      Stretch="Uniform"
                                      Margin="0,0,8,0" />
                                <TextBlock x:Name="SendAllToKindleButtonText" Text="Send All to Kindle" />
                            </StackPanel>
                        </Button>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="12" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Button Grid.Column="0"
                                    Content="Open Folder"
                                    Style="{StaticResource SecondaryButton}"
                                    HorizontalAlignment="Stretch"
                                    Click="OpenFolder_Click" />
                            <Button Grid.Column="2"
                                    Content="Convert More"
                                    Style="{StaticResource SecondaryButton}"
                                    HorizontalAlignment="Stretch"
                                    Click="ConvertAnother_Click" />
                        </Grid>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2"
                Margin="0,16,0,0"
                Padding="12,8"
                CornerRadius="8"
                Background="{StaticResource CardBrush}">
            <TextBlock x:Name="StatusText"
                       Text="Ready"
                       FontSize="13"
                       Foreground="{StaticResource TextMutedBrush}"
                       HorizontalAlignment="Center" />
        </Border>

        <!-- Footer -->
        <StackPanel Grid.Row="3"
                    Orientation="Horizontal"
                    HorizontalAlignment="Center"
                    Margin="0,12,0,0">
            <TextBlock Text="by"
                       FontSize="11"
                       Foreground="{StaticResource TextMutedBrush}"
                       VerticalAlignment="Center" />
            <TextBlock x:Name="VoidMindLink"
                       Text="VoidMind"
                       FontSize="11"
                       Foreground="{StaticResource PrimaryBrush}"
                       Margin="4,0,0,0"
                       Cursor="Hand"
                       VerticalAlignment="Center"
                       MouseLeftButtonUp="VoidMindLink_Click"
                       ToolTip="voidmind.io">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="TextDecorations" Value="Underline" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
            <TextBlock Text="·"
                       FontSize="11"
                       Foreground="{StaticResource TextMutedBrush}"
                       Margin="8,0"
                       VerticalAlignment="Center" />
            <TextBlock x:Name="CoffeeLink"
                       Text="Buy me a coffee"
                       FontSize="11"
                       Foreground="{StaticResource TextMutedBrush}"
                       Cursor="Hand"
                       VerticalAlignment="Center"
                       MouseLeftButtonUp="CoffeeLink_Click"
                       ToolTip="Support VoidMind">
                <TextBlock.Style>
                    <Style TargetType="TextBlock">
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="{StaticResource PrimaryBrush}" />
                                <Setter Property="TextDecorations" Value="Underline" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </TextBlock.Style>
            </TextBlock>
        </StackPanel>
    </Grid>
</Window>
